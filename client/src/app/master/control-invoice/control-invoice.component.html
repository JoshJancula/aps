<div class="row">
  <div class='col-md-5 col-sm-12'>
    <div class='row'>
      <mat-card>
        <div class="card-heading" *ngIf='editing === false'>Add Invoice</div>
        <div class="card-heading" *ngIf='editing === true'>Edit Invoice</div>
        <mat-checkbox *ngIf="editing === false" color="primary" [(ngModel)]="selectFromClients">Select from clients</mat-checkbox>
        <br>
        <mat-form-field *ngIf='selectFromClients === true'>
          <mat-select placeholder="Client" [disabled]="editing === true" [(ngModel)]="Invoice.Client">
            <mat-option *ngFor="let client of clients" [value]="client.Name">{{ client.Name }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field *ngIf='selectFromClients === false'>
          <input matInput placeholder="Client" [readonly]="editing === true" [(ngModel)]="Invoice.Client" />
        </mat-form-field>
        <mat-form-field>
          <mat-select placeholder="Products and services" [disabled]="editing === true" [(ngModel)]="Invoice.ServiceType">
            <mat-option *ngFor="let service of serviceTypes" (click)='clearTotals();' [value]="service">{{ service }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-checkbox (click)='clearZeros();' *ngIf="Invoice.ServiceType !== ''" color="primary" [(ngModel)]="manualAmountInput">Manually
          input price(s)</mat-checkbox>

        <mat-form-field *ngIf="Invoice.ServiceType ===  'New car pinstriping'">
          <mat-select placeholder="Rate per car" [(ngModel)]="newCarRate">
            <mat-option *ngFor="let price of prices" (click)="updateTotal();" [value]="price">${{ price }}</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- pinstriping invoice code -->
        <div *ngIf="Invoice.ServiceType === 'Pinstripe repair' || Invoice.ServiceType === 'Pinstripe repair & Paint protection' && editing === false">
          <mat-form-field>
            <mat-select placeholder="Panels striped" [(ngModel)]="panelsStriped">
              <mat-option *ngFor="let panel of panelOptions" [value]="panel.id">{{ panel.id }}</mat-option>
            </mat-select>
          </mat-form-field>
          <br>
          <div *ngIf="panelsStriped !== ''">
            <div *ngFor="let panel of panelOptions">
              <div *ngIf="panelsStriped === 8">
                <mat-form-field *ngIf='manualAmountInput === false'>
                  <mat-select placeholder="{{panel.model}} price" [(ngModel)]="panel.value">
                    <mat-option *ngFor="let price of prices" (click)="updateTotal();" [value]="price">${{ price }}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field *ngIf='manualAmountInput === true'>
                  <input matInput placeholder="{{panel.model}} price" [(ngModel)]="panel.value" />
                </mat-form-field>
              </div>
              <div *ngIf="panelsStriped !== 8 ">
                <mat-form-field *ngIf="panel.id <= panelsStriped && manualAmountInput === false">
                  <mat-select placeholder="{{panel.model}} price" [(ngModel)]="panel.value">
                    <mat-option *ngFor="let price of prices" (click)="updateTotal();" [value]="price">${{ price }}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field *ngIf="manualAmountInput === true && panel.id <= panelsStriped">
                  <input matInput placeholder="{{panel.model}} price" [(ngModel)]="panel.value" />
                </mat-form-field>
              </div>
            </div>
          </div>
        </div>

        <mat-checkbox *ngIf="Invoice.ServiceType === 'Pinstripe repair' || Invoice.ServiceType === 'Pinstripe repair' || Invoice.ServiceType === 'Pinstripe repair & Paint protection' && editing === false"
          color="primary" [(ngModel)]="customPinstriping">Add custom pinstriping?</mat-checkbox>
        <div *ngIf="customPinstriping === true">
          <mat-form-field *ngIf='manualAmountInput === false'>
            <mat-select placeholder="Price" [(ngModel)]="customPinstripes.value">
              <mat-option *ngFor="let price of prices" (click)="updateTotal();" [value]="price">${{ price }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field *ngIf='manualAmountInput === true'>
            <input matInput placeholder="Price" [(ngModel)]="customPinstripes.value" />
          </mat-form-field>
          <mat-form-field>
            <input matInput placeholder="Description" [(ngModel)]="customPinstripes.description" />
          </mat-form-field>
        </div>

        <!-- if stripes with ppf -->
        <div *ngIf="(Invoice.ServiceType === 'Pinstripe repair & Paint protection' && editing === false) || (Invoice.ServiceType === 'Paint protection with install' && editing === false) || (Invoice.ServiceType === 'Paint protection no install' && editing === false)">
          <span>Add PPF</span>
          <span *ngFor="let option of ppfOptions">
            <button mat-button color="primary" (click)="addPPF(option);">Add {{ option.model }}</button>
          </span>
          <div *ngFor='let ppf of ppfAdded' class='row'>
            <div class='col-md-10 col-sm-10'>
              <mat-form-field *ngIf='manualAmountInput === false'>
                <mat-select placeholder="{{ppf.model}} price" [(ngModel)]="ppf.value">
                  <mat-option *ngFor="let price of prices" (click)="updateTotal();" [value]="price">${{ price }}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field *ngIf='manualAmountInput === true'>
                <input matInput placeholder="{{ppf.model}} price" [(ngModel)]="ppf.value" />
              </mat-form-field>
            </div>
            <div class='col-md-2 col-sm-2'>
              <mat-icon (click)='removePPF(PPF)'>close</mat-icon>
            </div>
          </div>
        </div>

        <!-- all others -->
        <div *ngIf="Invoice.ServiceType !== 'Pinstripe repair & Paint protection' && Invoice.ServiceType !== 'Pinstripe repair' && Invoice.ServiceType !== '' && Invoice.ServiceType !== 'Window tint' && Invoice.ServiceType !== 'New car pinstriping' ">
          <mat-form-field *ngIf='manualAmountInput === false'>
            <mat-select placeholder="Price" [(ngModel)]="Invoice.Total">
              <mat-option *ngFor="let price of prices" [value]="price">${{ price }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field *ngIf='manualAmountInput === true'>
            <input matInput placeholder="Price" [(ngModel)]="Invoice.Total" />
          </mat-form-field>
          <mat-form-field *ngIf="Invoice.ServiceType !== 'New car pinstriping'">
            <input matInput placeholder="Description" [(ngModel)]="Invoice.Description" />
          </mat-form-field>
        </div>

        <!-- window tint -->
        <div *ngIf="Invoice.ServiceType === 'Window tint' && editing === false">
          <div class='row'>
            <mat-checkbox *ngFor="let win of windowOptions" color='primary' [(ngModel)]="win.selected">{{ win.model }}</mat-checkbox>
          </div>
          <div *ngFor="let win of windowOptions">

            <div class='row' *ngIf='win.selected === true;'>
              <div class='col-md-6 col-sm-6'>
                <mat-form-field>
                  <input matInput readonly [(ngModel)]="win.model" />
                </mat-form-field>
              </div>
              <div class='col-md-3 col-sm-3'>
                <mat-form-field *ngIf='manualAmountInput === false'>
                  <mat-select placeholder="Price" [(ngModel)]="win.value">
                    <mat-option *ngFor="let price of prices" [value]="price">${{ price }}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field *ngIf='manualAmountInput === true'>
                  <input matInput placeholder="Price" [(ngModel)]="win.val" />
                </mat-form-field>
              </div>
              <div class='col-md-3 col-sm-3'>
                <mat-form-field>
                  <mat-select placeholder="Quantity" [(ngModel)]="win.quantity">
                    <mat-option *ngFor="let win of windowOptions" [value]="win.id">{{ win.id }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

            </div>
          </div>

        </div>

        <div *ngIf="editing === true " readonly>
          {{ Invoice.Description }}
        </div>
        <br>
        <!-- buttons for input options -->
        <div *ngIf="Invoice.ServiceType !== ''">
          <button class='submit' (click)="addRO = true; addStock = false; addVIN = false;" mat-button>Add RO#</button>
          <button class='submit' [disabled]="editing === true" (click)="addStock = true; addRO = false; addVIN = false;"
            mat-button>Add Stock#(s)</button>
          <button class='submit' [disabled]="editing === true" (click)="addStock = false; addRO = false; addVIN = true;"
            maxlength="8" mat-button>Add VIN#(s)</button>
        </div>
        <br>
        <!-- stock numbers populate here -->
        <div class='row' *ngIf='stocks.length > 0 || vins.length > 0'>
          <div class='col-md-1 col-sm-0'></div>
          <div class='col-md-10 col-sm-0'>
            <div class='row vehicles' *ngFor="let stock of stocks">
              <div class='col-md-10 col-sm-10'>
                <span style='font-size: 12px'>Stock#</span> {{ stock }}
              </div>
              <div class='col-md-2 col-sm-2'>
                <mat-icon style='padding-top: 0%;' (click)="removeVehicle(stock);" mat-button>close</mat-icon>
              </div>
            </div>
            <div class='row vehicles' *ngFor="let vin of vins">
              <div class='col-md-10 col-sm-10'>
                <span style='font-size: 12px'>VIN#</span> {{ vin }}
              </div>
              <div class='col-md-2 col-sm-2'>
                <mat-icon style='padding-top: 30%;' (click)="removeVehicle(vin);" mat-button>close</mat-icon>
              </div>
            </div>
          </div>
          <div class='col-md-1 col-sm-0'></div>
        </div>

        <!-- manual input stocks vins and ro -->
        <mat-form-field *ngIf='addStock === true'>
          <input matInput placeholder="Stock#" [(ngModel)]="stockNumber" />
        </mat-form-field>
        <mat-form-field *ngIf='addVIN === true'>
          <input matInput placeholder="VIN#" [(ngModel)]="stockNumber" />
          <mat-hint align="start">Last 8 characters</mat-hint>
        </mat-form-field>
        <button *ngIf="addStock === true || addVIN === true" class='addVehicle' (click)="pushVehicle();" mat-button>Add</button>
        <mat-form-field *ngIf='addRO === true'>
          <input matInput placeholder="RO#" [(ngModel)]="Invoice.RO" />
        </mat-form-field>

        <!-- add description if they want -->
        <mat-checkbox color="primary" *ngIf="Invoice.ServiceType === 'Pinstripe repair & Paint protection' || Invoice.ServiceType === 'Pinstripe repair' || Invoice.ServiceType === 'Window tint' || Invoice.ServiceType === 'New car pinstriping' "
          [(ngModel)]="addDescription">Add Vehicle description?</mat-checkbox>
        <mat-form-field *ngIf='addDescription === true'>
          <input matInput placeholder="Make, model, color..." [(ngModel)]="Invoice.VehicleDescription" />
        </mat-form-field>


        <!-- total cost and payment info -->
        <mat-form-field *ngIf="Invoice.ServiceType !== '' && Invoice.Total !== 0">
          <input matInput placeholder="Total" [readonly]='editing === false' [(ngModel)]="Invoice.Total" />
        </mat-form-field>
        <mat-form-field *ngIf="Invoice.ServiceType !== '' && Invoice.Total !== 0">
          <mat-select placeholder="Payment method" [(ngModel)]="Invoice.PaymentMethod">
            <mat-option *ngFor="let method of paymentMethods" [value]="method">{{ method }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field *ngIf="Invoice.PaymentMethod === 'PO'">
          <input matInput placeholder="PO#" [(ngModel)]="Invoice.PO" />
        </mat-form-field>
        <mat-form-field *ngIf="Invoice.PaymentMethod === 'Check'">
          <input matInput placeholder="Check#" [(ngModel)]="Invoice.CheckNumber" />
        </mat-form-field>
        <!-- <mat-form-field>
          <mat-select placeholder="Franchise" [(ngModel)]="Invoice.FranchiseId">
            <mat-option *ngFor="let franchise of franchises" [value]="franchise.id">{{ franchise.Name }}</mat-option>
          </mat-select>
        </mat-form-field> -->

        <!-- comments and description if applicable -->
        <mat-form-field>
          <input matInput placeholder="Comments" [(ngModel)]="Invoice.Comments" />
        </mat-form-field>
        <br>
        <div>
          <label style="margin-left: 5%;">Paid</label>
          <mat-slide-toggle color="primary" [(ngModel)]="Invoice.Paid"></mat-slide-toggle>
        </div>
        <br>
        <!-- buttons -->
        <button class='submit' (click)="submitInvoice();" mat-button>Save Invoice</button>
        <button (click)="clearForm();" mat-button>Clear form</button>
        <button *ngIf='editing === true' (click)="deleteInvoice(Invoice.id);" mat-button>Delete</button>
      </mat-card>
    </div>
  </div>
  <div class='col-md-4 col-sm-12'>
    <div class='row'>
      <mat-card>
        <div class="card-heading">Invoices</div>
        <div *ngFor="let invoice of invoices">
          <p>
            #: {{invoice.id}}<br>
            Date: {{ formatDate(invoice.createdAt) }} <br>
            Client: {{ invoice.Client }} <br>
            Employee: {{ invoice.Employee }}<br>

          </p>
          <button (click)="editInvoice(invoice.id);" mat-button>Edit</button>
        </div>
      </mat-card>
    </div>
  </div>
</div>